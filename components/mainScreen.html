<script type="text/javascript">
snow.ui.registerComponent("mainScreen", 
	{
    parent: "#page",
	unique: true
	}, 
	{
	build: function(){
		var $e = $("#tmpl-mainScreen").render({});
		return $e;
	}, 
	postDisplay: function(){
		var component = this;
		var $element = this.$element;
		
		$element.sTouch(".generateButton",function(e){
			var $frtText = $("#frtText");
			var $scdText = $("#scdText");
			var $frtColumn = $("#frtColumnName");
			var butType = $(this).closest(".motionOrRaw").attr("data-obj_type");
			
			var frtColumnName = $frtColumn.val();
			if(frtColumnName == ""){
				alert("The First Column Name can not null!");
			}else{
				var frtTextVal = $frtText.val();
				var scdTextVal = "";
				if(butType == "raw"){
					//this is for the raw format
					scdTextVal = gei.generateRawValue(frtTextVal,frtColumnName);
				}else{
					//this is for the motion format
					scdTextVal = gei.generateMotionValue(frtTextVal,frtColumnName);
				}
				
				$scdText.text("").val(scdTextVal);
			}
		});
		
		$element.sTouch(".clearButton",function(e){
			$("#frtText").text("");
			$("#scdText").text("");
		});
		
		$element.sTouch(".import",function(e){
			//start Read
			var file = $("#file")[0].files[0];
			var str = $("#file").val();
			var pos = str.lastIndexOf(".");
			var lastname = str.substring(pos,str.length)
			
			if (lastname.toLowerCase()!=".csv"){
				alert("The file type must be .csv");
				return false;
			}else{
				if(file){
					var reader = new FileReader();
					reader.readAsText(file);
					reader.onload = loaded;
					reader.onerror = errorHandler;
				}
			}
		});
		
		function loaded(evt) {  
			var fileString = evt.target.result;
			var $frtText = $("#frtText");
			$frtText.text("").val(fileString);
		}

		function errorHandler(evt) {
			if(evt.target.error.name == "NOT_READABLE_ERR") {
				alert("The file could not be read");
			}
		}
		
	}
});

</script>

<script id="tmpl-mainScreen" type="text/html">
<div class="mainScreen">
	<div class="frtColumnName">
		First Column Name:<input id="frtColumnName" name="frtColumnName" value=""/>
		<br>
		CSV File: <input id="file" type="file">
		          <button class="import">Import</button>
	</div>
	
	<div class="firstArea">
		Input TextArea:</br>
		<textarea id="frtText" cols="50" rows="30"></textarea>
	</div>
	
	<div class="generate">
		<div class="motionOrRaw" data-obj_type="motion">
			<span>Motion Format:</span>
			<button class="generateButton"> Generate >> </button>
		</div>
		<div class="genDiv motionOrRaw" data-obj_type="raw">
			<span>Raw Format:</span>
			<button class="generateButton"> Generate >> </button>
		</div>
		<div class="genDiv">
			<span>Clear TextArea Data:</span>
			<button class="clearButton"> Clear All </button>
		</div>
	</div>
	
	<div class="sencondArea">
		Output TextArea:</br>
		<textarea id="scdText" cols="50" rows="30"></textarea>
	</div>
</div>	
</script>
