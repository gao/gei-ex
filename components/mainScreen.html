<script type="text/javascript">
snow.ui.registerComponent("mainScreen", 
	{
    parent: "#page",
	unique: true
	}, 
	{
	build: function(){
		var $e = $("#tmpl-mainScreen").render({});
		return $e;
	}, 
	postDisplay: function(){
		var component = this;
		var $element = this.$element;
		
		$element.sTouch(".generateButton",function(e){
			var $frtText = $("#frtText");
			var $scdText = $("#scdText");
			var $frtColumn = $("#frtColumnName");
			var butType = $(this).closest(".motionOrRaw").attr("data-obj_type");
			
			var frtColumnName = $frtColumn.val();
			if(frtColumnName == ""){
				alert("The First Column Name can not null!");
			}else{
				var frtTextVal = $frtText.val();
				var scdTextVal = "";
				if(butType == "raw"){
					//this is for the raw format
					scdTextVal = gei.generateRawValue(frtTextVal,frtColumnName);
				}else if(butType == "motion"){
					//this is for the motion format
					scdTextVal = gei.generateMotionValue(frtTextVal,frtColumnName);
				}else if(butType == "type1"){
					//this is for the motion format
					scdTextVal = gei.generateTypeValue(frtTextVal,frtColumnName,butType);
				}
				
				$scdText.text("").val(scdTextVal);
			}
		});
		
		$element.sTouch(".clearButton",function(e){
			$("#frtText").text("");
			$("#scdText").text("");
		});
		
		// --------- import the csv file --------- //
		$element.sTouch(".import",function(e){
			//start Read
			var file = $("#file")[0].files[0];
			var str = $("#file").val();
			var pos = str.lastIndexOf(".");
			var lastname = str.substring(pos,str.length)
			
			if (lastname.toLowerCase()!=".csv"){
				alert("The file type must be .csv");
				return false;
			}else{
				if(file){
					var reader = new FileReader();
					reader.readAsText(file);
					reader.onload = loaded;
					reader.onerror = errorHandler;
				}
			}
		});
		
		function loaded(evt) {  
			var fileString = evt.target.result;
			var $frtText = $("#frtText");
			$frtText.text("").val(fileString);
		}

		function errorHandler(evt) {
			if(evt.target.error.name == "NOT_READABLE_ERR") {
				alert("The file could not be read");
			}
		}
		// --------- /import the csv file --------- //
		
		$element.sTouch(".create",function(e){
//			var type = $(this).closest(".createType").attr("data-obj_type");
//			if(type == 'Type1'){
//				var url = "https://www.google.com/fusiontables/api/query?sql=SELECT * FROM 896069 WHERE Scenario='BAU' AND Name='Difference (2009 $ billions)'";
//				$.ajax({
//					type: "GET",
//				   	url: url,
//				   	success: function(data,textStatus){
//						console.log("---success---textStatus:"+textStatus);
//						console.log(data);
//				   	},
//				   	error: function(XMLHttpRequest,textStatus){
//						console.log("---error---textStatus:"+textStatus);
//						console.log(XMLHttpRequest);
//				   	}
//				});
//			}
			
		});
		
	}
});

</script>

<script id="tmpl-mainScreen" type="text/html">
<div class="mainScreen">
	<div class="frtColumnName">
		First Column Name:<input id="frtColumnName" name="frtColumnName" value=""/>
		<br>
		CSV File: <input id="file" type="file">
		          <button class="import">Import</button>
	</div>
	<!--
	<div class="createTypeDiv">
		<div class="title">
			<span>Generate From Fusion Table:</span>
		</div>
		<div class="createType" data-obj_type="Type1">
			<button class="create">Create TYPE1</button>
		</div>
	</div>
	-->
	<div class="firstArea">
		Input TextArea:</br>
		<textarea id="frtText" cols="50" rows="30"></textarea>
	</div>
	
	<div class="generate">
		<div class="motionOrRaw" data-obj_type="motion">
			<button class="generateButton"> Motion Format >> </button>
		</div>
		<div class="genDiv motionOrRaw" data-obj_type="raw">
			<button class="generateButton"> Raw Format >> </button>
		</div>
		<div class="genDiv motionOrRaw" data-obj_type="type1">
			<button class="generateButton"> Type1 Format >> </button>
		</div>
		<div class="genDiv">
			<button class="clearButton"> Clear All Data </button>
		</div>
	</div>
	
	<div class="sencondArea">
		Output TextArea:</br>
		<textarea id="scdText" cols="50" rows="30"></textarea>
	</div>
</div>	
</script>
